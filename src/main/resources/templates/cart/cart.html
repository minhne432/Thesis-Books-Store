<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Giỏ hàng của bạn</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
</head>
<body>
<!-- Thanh điều hướng (Navbar) -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" th:href="@{/}">Cosmetic Shop</a>
    <!-- Các mục khác trong navbar -->
</nav>

<div class="container mt-5">
    <h2 class="mb-4">Giỏ hàng của bạn</h2>
    <div th:if="${#lists.isEmpty(cartItems)}">
        <p>Giỏ hàng của bạn đang trống. <a th:href="@{/products}">Tiếp tục mua sắm</a>.</p>
    </div>
    <div th:if="${!#lists.isEmpty(cartItems)}">
        <!-- Bind the form to cartUpdateForm -->
        <form th:action="@{/cart/update}" method="post" th:object="${cartUpdateForm}">
            <!-- CSRF Token -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <table class="table table-bordered table-hover">
                <thead class="thead-light">
                <tr>
                    <th>Sản phẩm</th>
                    <th>Giá</th>
                    <th>Số lượng</th>
                    <th>Tổng cộng</th>
                    <th>Hành động</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item, iterStat : ${cartItems}">
                    <td>
                        <div class="media">
                            <div class="media-body">
                                <h5 class="mt-0" th:text="${item.product.productName}">Tên sản phẩm</h5>
                                <p th:text="${item.product.description}">Mô tả sản phẩm</p>
                            </div>
                        </div>
                    </td>
                    <td th:text="${item.product.price}">Giá</td>
                    <td>
                        <!-- Use th:field with proper indexing -->
                        <input type="hidden" th:field="*{cartItems[__${iterStat.index}__].cartItemId}" />
                        <input type="number" th:field="*{cartItems[__${iterStat.index}__].quantity}"
                               class="form-control" min="1" style="width: 80px;" />
                    </td>
                    <td th:text="${item.product.price * item.quantity}">Tổng cộng</td>
                    <td>
                        <a th:href="@{'/cart/remove/' + ${item.cartItemID}}" class="btn btn-sm btn-danger">Xóa</a>
                    </td>
                </tr>
                </tbody>
            </table>
            <div class="text-right">
                <button type="submit" class="btn btn-primary">Cập nhật giỏ hàng</button>
            </div>
        </form>
        <div class="row mt-3">
            <div class="col-md-6">
                <a th:href="@{/products}" class="btn btn-secondary">Tiếp tục mua sắm</a>
            </div>
            <div class="col-md-6 text-right">
                <h4>Tổng tiền:
                    <span th:text="${totalAmount}"></span>
                </h4>
                <a th:href="@{/checkout}" class="btn btn-success btn-lg">Tiến hành thanh toán</a>
            </div>
        </div>
    </div>
</div>

</body>
