erDiagram

%% ------------------------------
%% CUSTOMER-RELATED ENTITIES
%% ------------------------------

    CUSTOMER {
        int CustomerID PK
        string CustomerType
        string Username
        string Email
        string PasswordHash
        string Salt
        string FirstName
        string LastName
        string Phone
        date DateOfBirth
        date DateJoined
        date LastLoginDate
        boolean IsActive
        string ProfilePicture
        string PreferredLanguage
        string SecurityQuestion
        string SecurityAnswerHash
    }
    
    LOGIN_HISTORY {
        int LoginID PK
        int CustomerID FK
        datetime LoginTimestamp
        string IPAddress
        string DeviceInfo
        string LoginStatus
    }
    
    ADDRESS {
        int AddressID PK
        int CustomerID FK
        int WardID FK
        string StreetAddress
        string PostalCode
        boolean IsDefault
    }

    CUSTOMER ||--o{ ADDRESS : "has"
    CUSTOMER ||--o{ LOGIN_HISTORY : "has"
    CUSTOMER ||--|| CART : "has"
    CUSTOMER ||--o{ REVIEW : "writes"
    CUSTOMER ||--o{ COUPON_USAGE : "redeems"
    CUSTOMER ||--o{ USER_ROLE : "has"

%% ------------------------------
%% PRODUCT-RELATED ENTITIES
%% ------------------------------

    PRODUCT {
        int ProductID PK
        string ProductName
        string Brand
        string Category
        string Description
        decimal Price
        int StockQuantity
    }

    CART {
        int CartID PK
        int CustomerID FK
        date CreatedDate
    }

    CART_ITEM {
        int CartItemID PK
        int CartID FK
        int ProductID FK
        int Quantity
    }

    REVIEW {
        int ReviewID PK
        int OrderDetailID FK
        int Rating
        string Comment
        date ReviewDate
    }

    CART ||--|{ CART_ITEM : "contains"
    PRODUCT ||--o{ CART_ITEM : "is added to"
    PRODUCT ||--o{ REVIEW : "receives"
    ORDER_DETAILS ||--o{ REVIEW : "has"

%% ------------------------------
%% ORDER-RELATED ENTITIES
%% ------------------------------

    ORDER {
        int OrderID PK
        date OrderDate
        decimal TotalAmount
        string Status
        string PaymentMethod
        int CustomerID FK
        int BranchID FK
        int CouponID FK
        int AddressID FK
    }

    ORDER_DETAILS {
        int OrderDetailID PK
        int OrderID FK
        int ProductID FK
        int Quantity
        decimal UnitPrice
    }

    PAYMENT {
        int PaymentID PK
        int OrderID FK
        date PaymentDate
        decimal AmountPaid
        string PaymentStatus
    }

    COUPON_USAGE {
        int CouponUsageID PK
        int CouponID FK
        int CustomerID FK
        int OrderID FK
        date RedemptionDate
        decimal DiscountAmount
    }

    COUPON {
        int CouponID PK
        string Code
        string Description
        string DiscountType
        decimal DiscountValue
        date StartDate
        date EndDate
        decimal MinimumOrderValue
        int MaxUsageLimit
        boolean IsActive
    }

    CUSTOMER ||--o{ ORDER : "places"
    ORDER ||--|{ ORDER_DETAILS : "contains"
    ORDER ||--|| PAYMENT : "has"
    ORDER }o--|| ADDRESS : "delivered to"
    ORDER ||--o{ COUPON_USAGE : "applies to"
    ORDER ||--|| BRANCH : "fulfilled by"
    ORDER_DETAILS ||--|| ORDER : "belongs to"
    ORDER_DETAILS ||--|| PRODUCT : "includes"
    PRODUCT ||--o{ ORDER_DETAILS : "is part of"
    COUPON ||--o{ COUPON_USAGE : "is used in"
    CUSTOMER ||--o{ COUPON_USAGE : "redeems"

%% ------------------------------
%% INVENTORY AND SUPPLY ENTITIES
%% ------------------------------

    INVENTORY {
        int InventoryID PK
        int BranchID FK
        int ProductID FK
        int Quantity
        date LastUpdatedDate
    }

    BRANCH {
        int BranchID PK
        string BranchName
        string Location
        decimal Latitude
        decimal Longitude
        string ContactNumber
        string Manager
    }

    SUPPLIER {
        int SupplierID PK
        string SupplierName
        string ContactPerson
        string Phone
        string Email
        string Address
    }

    PURCHASE_ORDER {
        int PurchaseOrderID PK
        int SupplierID FK
        int BranchID FK
        date OrderDate
        decimal TotalAmount
        string Status
    }

    PURCHASE_ORDER_DETAILS {
        int PurchaseOrderDetailID PK
        int PurchaseOrderID FK
        int ProductID FK
        int Quantity
        decimal UnitPrice
        date ReceivedDate
    }

    BRANCH ||--|{ INVENTORY : "manages"
    PRODUCT ||--o{ INVENTORY : "is stored in"
    BRANCH ||--o{ ORDER : "fulfills"
    BRANCH ||--o{ PURCHASE_ORDER : "places"
    SUPPLIER ||--o{ PURCHASE_ORDER : "receives"
    PURCHASE_ORDER ||--|{ PURCHASE_ORDER_DETAILS : "contains"
    PRODUCT ||--o{ PURCHASE_ORDER_DETAILS : "is part of"

%% ------------------------------
%% ROLE AND PERMISSION ENTITIES
%% ------------------------------

    ROLE {
        int RoleID PK
        string RoleName
        string Description
    }

    PERMISSION {
        int PermissionID PK
        string PermissionName
        string Description
    }

    USER_ROLE {
        int UserRoleID PK
        int CustomerID FK
        int RoleID FK
    }

    ROLE_PERMISSION {
        int RolePermissionID PK
        int RoleID FK
        int PermissionID FK
    }

    CUSTOMER ||--o{ USER_ROLE : "has"
    ROLE ||--o{ USER_ROLE : "is assigned to"
    ROLE ||--o{ ROLE_PERMISSION : "has"
    PERMISSION ||--o{ ROLE_PERMISSION : "is granted to"

%% ------------------------------
%% GEOGRAPHICAL ENTITIES
%% ------------------------------

    PROVINCE {
        int ProvinceID PK
        string ProvinceName
    }

    DISTRICT {
        int DistrictID PK
        int ProvinceID FK
        string DistrictName
    }

    WARD {
        int WardID PK
        int DistrictID FK
        string WardName
        decimal Latitude
        decimal Longitude
    }

    PROVINCE ||--o{ DISTRICT : "contains"
    DISTRICT ||--o{ WARD : "contains"
    WARD ||--o{ ADDRESS : "includes"

